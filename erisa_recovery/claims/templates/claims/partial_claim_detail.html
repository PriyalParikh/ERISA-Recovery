{% load claim_extras %}
<!-- Claim Details Card -->
<div class="bg-white rounded-lg shadow p-6 mb-6">
  <div class="flex items-center justify-between mb-4">
    <h2 class="text-xl font-semibold text-gray-900">
      <span class="text-blue-600">📄</span> Claim Details - {{ claim.id }}
    </h2>
    <span class="inline-flex px-3 py-1 text-sm font-medium 
      {% if claim.status == 'Denied' %}bg-red-100 text-red-800
      {% elif claim.status == 'Paid' %}bg-green-100 text-green-800
      {% elif claim.status == 'Under Review' %}bg-blue-100 text-blue-800
      {% else %}bg-gray-100 text-gray-800{% endif %} rounded-full">
      {{ claim.status }}
    </span>
  </div>
  
  <div class="space-y-4 mb-6">
    <div>
      <h3 class="font-medium text-gray-700 mb-1">Patient:</h3>
      <p class="text-lg font-semibold text-gray-900">{{ claim.patient_name }}</p>
    </div>
    <div>
      <h3 class="font-medium text-gray-700 mb-1">Discharge Date:</h3>
      <p class="text-gray-900">{{ claim.discharge_date|date:"n/j/Y" }}</p>
    </div>
  </div>

  <div class="grid grid-cols-1 gap-4 mb-6">
    <div>
      <h3 class="font-medium text-gray-700 mb-1">Billed Amount:</h3>
      <p class="text-2xl font-bold text-gray-900">${{ claim.billed_amount|floatformat:2 }}</p>
    </div>
    <div>
      <h3 class="font-medium text-gray-700 mb-1">Paid Amount:</h3>
      <p class="text-2xl font-bold {% if claim.paid_amount == 0 %}text-red-600{% else %}text-green-600{% endif %}">
        ${{ claim.paid_amount|floatformat:2 }}
      </p>
    </div>
  </div>

  {% if claim.detail %}
  <div class="mb-4">
    <h3 class="font-medium text-gray-700 mb-2">CPT Codes:</h3>
    <div class="flex gap-2 flex-wrap">
      {% for code in claim.detail.cpt_codes|split:" " %}
        {% if code %}
        <span class="inline-flex px-2 py-1 text-sm bg-gray-100 text-gray-800 rounded">{{ code }}</span>
        {% endif %}
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <div class="mb-4">
    <h3 class="font-medium text-gray-700 mb-1">Insurer:</h3>
    <p class="text-gray-900">{{ claim.insurer_name }}</p>
  </div>

  {% if claim.detail.denial_reason %}
  <div class="mb-4">
    <h3 class="font-medium text-gray-700 mb-1">Denial Reason:</h3>
    <p class="text-red-600 font-medium">{{ claim.detail.denial_reason }}</p>
  </div>
  {% endif %}
</div>

<!-- Notes & Annotations -->
<div class="bg-white rounded-lg shadow mb-6">
  <div class="px-4 py-3 border-b">
    <h3 class="font-medium text-gray-900">📝 Notes & Annotations</h3>
  </div>
  <div class="p-4" id="notes-{{ claim.id }}">
    {% include "claims/partial_notes.html" with claim=claim %}
  </div>
</div>

<!-- Quick Actions -->
<div class="bg-white rounded-lg shadow">
  <div class="px-4 py-3 border-b">
    <h3 class="font-medium text-gray-900">Quick Actions</h3>
  </div>
  <div class="p-4 space-y-3">
    <button 
      hx-post="{% url 'toggle_flag' claim.id %}"
      hx-target="#claim-{{ claim.id }}"
      hx-swap="outerHTML"
      class="w-full flex items-center gap-2 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded">
      <span>🏷️</span> {% if claim.flagged %}Remove Flag{% else %}Flag for Review{% endif %}
    </button>
    <button 
      onclick="document.getElementById('add-note-form-{{ claim.id }}').style.display = document.getElementById('add-note-form-{{ claim.id }}').style.display === 'none' ? 'block' : 'none'"
      class="w-full flex items-center gap-2 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded">
      <span>📝</span> Add Note
    </button>
    <button class="w-full flex items-center gap-2 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded">
      <span>📊</span> Generate Report
    </button>
  </div>
  
  <!-- Hidden Add Note Form -->
  <div id="add-note-form-{{ claim.id }}" style="display: none;" class="p-4 border-t">
    <form 
      hx-post="{% url 'add_note' claim.id %}" 
      hx-target="#notes-{{ claim.id }}" 
      hx-swap="outerHTML">
      {% csrf_token %}
      <textarea name="text" 
                class="w-full p-2 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" 
                rows="3"
                placeholder="Add a note..."></textarea>
      <div class="flex gap-2 mt-2">
        <button type="submit" 
                class="px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600">
          Add Note
        </button>
        <button type="button" 
                onclick="document.getElementById('add-note-form-{{ claim.id }}').style.display = 'none'"
                class="px-3 py-1 bg-gray-300 text-gray-700 text-sm rounded hover:bg-gray-400">
          Cancel
        </button>
      </div>
    </form>
  </div>
</div>
